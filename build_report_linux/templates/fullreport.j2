<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ansible Linux Automation Report</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #000;
      padding: 15px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header img {
      height: 40px;
    }
    h1 {
      text-align: center;
      background: #1a1a1a;
      color: #fff;
      padding: 15px;
      margin: 0;
    }
    .search-bar {
      margin: 20px;
      text-align: right;
    }
    .search-bar input {
      padding: 8px;
      width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .host-card {
      background: #fff;
      margin: 15px;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .host-card h2 {
      margin: 0;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      color: #fff;
    }
    .status.up { background: #28a745; }
    .status.down { background: #dc3545; }
    .accordion h3 {
      background: #c00;
      color: #fff;
      padding: 10px;
      cursor: pointer;
      margin: 10px 0 0 0;
      border-radius: 5px 5px 0 0;
    }
    .accordion div {
      display: none;
      padding: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th {
      background: #c00;
      color: #fff;
      padding: 8px;
      text-align: left;
    }
    td {
      padding: 6px;
      border: 1px solid #ddd;
    }
    ul {
      margin: 0;
      padding-left: 18px;
    }
  </style>
</head>
<body>

<header>
  <div>
    <img src="https://www.redhat.com/profiles/rh/themes/redhatdotcom/img/logo.png" alt="Red Hat Logo">
    <span style="font-size:18px; margin-left:10px;">Ansible</span>
  </div>
</header>

<h1>Ansible Linux Automation Report</h1>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search host or IP...">
</div>

{% for linux_host in groups['linux'] %}
<div class="host-card" data-host="{{ linux_host }} {{ hostvars[linux_host]['ansible_host'] }}">
  <h2>
    <i class="fa fa-server"></i> {{ linux_host }}
    <span class="status up">Up-to-date</span>
  </h2>

  <p>
    <b>Package Manager:</b> {{ hostvars[linux_host]['package_manager'] | default("N/A") }}
    | <b>OS:</b> {{ hostvars[linux_host]['ansible_distribution'] }} {{ hostvars[linux_host]['ansible_distribution_version'] }}
    | <b>Kernel:</b> {{ hostvars[linux_host]['ansible_kernel'] }}
  </p>

  <!-- Accordion with Last Patch Info -->
  <div class="accordion">
    <h3>Last Patch Info</h3>
    <div>
      <table>
        <thead>
          <tr>
            <th colspan="2">Last Patch Info</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><b>IP Address</b></td>
            <td>{{ hostvars[linux_host]['ansible_host'] | default("N/A") }}</td>
          </tr>
          <tr>
            <td><b>User ID</b></td>
            <td>{{ hostvars[linux_host]['ansible_user_id'] | default("N/A") }}</td>
          </tr>
          <tr>
            <td><b>System Date</b></td>
            <td>{{ hostvars[linux_host]['system_date'].stdout | default("N/A") }}</td>
          </tr>
          <tr>
            <td><b>Last Reboot Time</b></td>
            <td>{{ hostvars[linux_host]['last_reboot'].stdout | default("N/A") }}</td>
          </tr>
          <tr>
            <td valign="top"><b>Last 15 Installed Packages</b></td>
            <td>
              <ul>
                {% for pkg in hostvars[linux_host]['last_installed_packages'].stdout_lines | default([]) %}
                  <li>{{ pkg }}</li>
                {% else %}
                  <li>No package data available</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endfor %}

<script>
  // Accordion toggle
  document.querySelectorAll(".accordion h3").forEach(function(header) {
    header.addEventListener("click", function() {
      var panel = this.nextElementSibling;
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    });
  });

  // Search filter
  document.getElementById("searchInput").addEventListener("keyup", function() {
    var filter = this.value.toLowerCase();
    var hosts = document.getElementsByClassName("host-card");
    for (var i = 0; i < hosts.length; i++) {
      var text = hosts[i].getAttribute("data-host").toLowerCase();
      hosts[i].style.display = text.includes(filter) ? "" : "none";
    }
  });
</script>

</body>
</html>
