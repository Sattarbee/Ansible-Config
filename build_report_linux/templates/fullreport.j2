<!DOCTYPE html>
<html>
<head>
  <title>Ansible Linux Automation Report</title>
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="css/new.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>

  <script>
    // CSV Export
    function downloadCSV(tableId, filename) {
      var csv = [];
      var rows = document.querySelectorAll("#" + tableId + " tr");

      for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");
        for (var j = 0; j < cols.length; j++) {
          row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
        }
        csv.push(row.join(","));
      }

      var csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
      var downloadLink = document.createElement("a");
      downloadLink.download = filename;
      downloadLink.href = window.URL.createObjectURL(csvFile);
      downloadLink.style.display = "none";
      document.body.appendChild(downloadLink);
      downloadLink.click();
    }

    // Table Search Filter
    (function(document) {
      'use strict';
      var TableFilter = (function(myArray) {
        var search_input;
        function _onInputSearch(e) {
          search_input = e.target;
          var tables = document.getElementsByClassName(search_input.getAttribute('data-table'));
          myArray.forEach.call(tables, function(table) {
            myArray.forEach.call(table.tBodies, function(tbody) {
              myArray.forEach.call(tbody.rows, function(row) {
                var text_content = row.textContent.toLowerCase();
                var search_val = search_input.value.toLowerCase();
                row.style.display = text_content.indexOf(search_val) > -1 ? '' : 'none';
              });
            });
          });
        }
        return {
          init: function() {
            var inputs = document.getElementsByClassName('search-input');
            myArray.forEach.call(inputs, function(input) {
              input.oninput = _onInputSearch;
            });
          }
        };
      })(Array.prototype);

      document.addEventListener('readystatechange', function() {
        if (document.readyState === 'complete') {
          TableFilter.init();
        }
      });
    })(document);
  </script>
</head>

<body>
<div class="wrapper">
  <header>
    <div class="header-container">
      <a href="https://ansible.com">
        <img class="header-logo" src="redhat-ansible-logo.svg" title="Red Hat Ansible" alt="Red Hat Ansible"/>
      </a>
    </div>
  </header>

  <section>
    <center>
      <h1>Ansible Linux Automation Report</h1>

      <!-- Download + Search -->
      <button onclick="downloadCSV('main_table', 'ansible_report.csv')">Download CSV</button>
      <h3><input type="search" placeholder="Search..." class="form-control search-input" data-table="main_table"/></h3>
    </center>

    <table id="main_table" class="table table-striped mt32 main_table">
      <thead>
        <tr>
          <th>Linux Device</th>
          <th>Package Manager</th>
          <th>Operating System</th>
          <th>Operating System Version</th>
          <th>Operating System Kernel Version</th>
        </tr>
      </thead>
      <tbody>
      {% for linux_host in ansible_play_hosts|sort %}
        <tr>
          <td class="summary_info">
            <div id="hostname">
              <p class="hostname">
                <img class="router_image" src="server.png"> {{ hostvars[linux_host]['inventory_hostname'].split('.')[0] }}
              </p>
            </div>
          </td>
          <td>{{ hostvars[linux_host]['ansible_pkg_mgr']|default("none") }}</td>
          <td>{{ hostvars[linux_host]['ansible_os_family']|default("none") }}</td>
          <td>{{ hostvars[linux_host]['ansible_distribution_version']|default("none") }}</td>
          <td>{{ hostvars[linux_host]['ansible_kernel']|default("none") }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <center>
      <p>Created with</p><br>
      <img src="webpage_logo.png" width="300">
    </center>
  </section>
</div>
</body>
</html>
