- name: Get Available Patches Info from Linux Hosts
  hosts: Linux
  become: true
  vars:
    detailedreport: true

  tasks:
    - name: Get list of available patches (security and others)
      shell: dnf check-update
      register: available_patches
      changed_when: false
      failed_when: false   # So play doesnâ€™t fail if no updates available

    - name: Debug raw yum check-update output
      debug:
        var: available_patches.stdout_lines

    - name: Scan Systems for detailed report
      include_role:
        name: shadowman_scan_systems
      when: detailedreport

# Run once to build report on the web server host
- name: Build the report using all hosts' data
  hosts: Linux
  run_once: true
  gather_facts: false
  become: true

  tasks:
    - name: Build the report
      include_role:
        name: build_report_linux
